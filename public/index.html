<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Asaf — CV Chatbot</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
      .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
      .title { margin: 6px 0 2px; }
      .sub { margin: 0 0 14px; color: #555; font-size: 14px; }
      .chat { border: 1px solid #ddd; border-radius: 12px; padding: 12px; height: 70vh; overflow-y: auto; background: #fafafa; }
      .row { display: flex; margin: 10px 0; }
      .row.user { justify-content: flex-end; }
      .row.bot { justify-content: flex-start; }
      .bubble { max-width: 78%; padding: 10px 12px; border-radius: 14px; line-height: 1.35; white-space: pre-wrap; }
      .user .bubble { background: #1f2937; color: #fff; border-bottom-right-radius: 4px; }
      .bot .bubble { background: #fff; color: #111; border: 1px solid #e5e7eb; border-bottom-left-radius: 4px; }
      .composer { display: flex; gap: 8px; margin-top: 12px; }
      input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; }
      button { padding: 12px 14px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .hint { font-size: 12px; color: #666; margin-top: 8px; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h2 class="title">Asaf — CV Chatbot</h2>
      <p class="sub">Ask about my background, experience, and interests. I answer from my CV + bio only.</p>

      <div id="chat" class="chat" aria-live="polite"></div>

      <div class="composer">
        <input id="question" type="text" placeholder="Ask a question..." />
        <button id="sendBtn" onclick="send()">Send</button>
      </div>
      <div class="hint">Tip: press <span class="mono">Enter</span> to send.</div>
    </div>

    <script>
      const chatEl = document.getElementById("chat");
      const inputEl = document.getElementById("question");
      const sendBtn = document.getElementById("sendBtn");

      function addMessage(role, text) {
        const row = document.createElement("div");
        row.className = "row " + role;

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.textContent = text;

        row.appendChild(bubble);
        chatEl.appendChild(row);
        chatEl.scrollTop = chatEl.scrollHeight;
      }

      function setBusy(isBusy) {
        sendBtn.disabled = isBusy;
        inputEl.disabled = isBusy;
      }

      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") send();
      });

      async function send() {
        const message = inputEl.value.trim();
        if (!message) return;

        addMessage("user", message);
        inputEl.value = "";

        setBusy(true);
        addMessage("bot", "…");

        try {
          const res = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
          });

          const data = await res.json();

          const rows = chatEl.querySelectorAll(".row.bot");
          const lastBot = rows[rows.length - 1];
          lastBot.querySelector(".bubble").textContent = data.reply || "(empty reply)";
        } catch (err) {
          const rows = chatEl.querySelectorAll(".row.bot");
          const lastBot = rows[rows.length - 1];
          lastBot.querySelector(".bubble").textContent = "Error: " + err.message;
        } finally {
          setBusy(false);
          inputEl.focus();
          chatEl.scrollTop = chatEl.scrollHeight;
        }
      }

      addMessage("bot", `Hello!

So, you're thinking about hiring Asaf? Well you've come to the right place. My name is AsafBot9000. I am a virtual simulacrum of one Asaf Rubin, PhD, MBA who isn't available right now, probably because he's off doing weird nerd stuff.

Not to worry though. Asaf's elected me as his proxy and I'm here to answer any and all questions you might have about him. Shoot!`);

      inputEl.focus();
    </script>
  </body>
</html>
